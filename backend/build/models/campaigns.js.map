{"version":3,"sources":["../../src/models/campaigns.js"],"names":["db","getCampaignContent","campaignId","success","error","campaigns","find","where","include","model","campaignContent","campaign_id","content_status","campaignText","campaignImages","then","results","rawCampaignData","rawContentData","campaign_contents","campaignInfo","name","length","fundingNeeded","donationsMade","startDate","endDate","contentInfo","contentId","content_id","contentStatus","createdDate","created_date","updatedDate","updatedAt","gatherCampaignText","rawTextData","textData","forEach","text_id","content_position","text_type","text","textElement","textId","contentPosition","textType","push","gatherCampaignImages","rawCampaignImages","imageData","img_id","image_type","src","alt","imgElement","imgId","imageType","campaign_texts","campaign_images","catch","findErr"],"mappings":";;;;;;;AAAA;;IAAYA,E;;;;AAEL,MAAMC,kDAAqB,CAACC,UAAD,EAAaC,OAAb,EAAsBC,KAAtB,KAAgC;AAChEJ,KAAGK,SAAH,CAAaC,IAAb,CAAkB;AAChBC,WAAO,EAAEL,UAAF,EADS;AAEhBM,aAAS,CACP;AACEC,aAAOT,GAAGU,eADZ;AAEEH,aAAO;AACLI,qBAAaT,UADR;AAELU,wBAAgB;AAFX,OAFT;AAMEJ,eAAS,CACP;AACEC,eAAOT,GAAGa;AADZ,OADO,EAIP;AACEJ,eAAOT,GAAGc;AADZ,OAJO;AANX,KADO;AAFO,GAAlB,EAoBGC,IApBH,CAoBSC,OAAD,IAAa;AACjB,UAAMC,kBAAkBD,OAAxB;AACA,UAAME,iBAAiBF,QAAQG,iBAAR,CAA0B,CAA1B,CAAvB;;AAEA,UAAMC,eAAe;AACnBlB,kBAAYe,gBAAgBf,UADT;AAEnBmB,YAAMJ,gBAAgBI,IAFH;AAGnBC,cAAQL,gBAAgBK,MAHL;AAInBC,qBAAeN,gBAAgBM,aAJZ;AAKnBC,qBAAeP,gBAAgBO,aALZ;AAMnBC,iBAAWR,gBAAgBQ,SANR;AAOnBC,eAAST,gBAAgBS;AAPN,KAArB;;AAUA,UAAMC,cAAc;AAClBC,iBAAWV,eAAeW,UADR;AAElB3B,kBAAYgB,eAAeP,WAFT;AAGlBmB,qBAAeZ,eAAeN,cAHZ;AAIlBmB,mBAAab,eAAec,YAJV;AAKlBC,mBAAaf,eAAegB;AALV,KAApB;;AAQA,UAAMC,qBAAsBC,WAAD,IAAiB;AAC1C,YAAMC,WAAW,EAAjB;AACAD,kBAAYE,OAAZ,CAAoB,CAClB;AACEC,eADF;AAEEV,kBAFF;AAGEW,wBAHF;AAIEC,iBAJF;AAKEC;AALF,OADkB,KAQf;AACH,cAAMC,cAAc;AAClBC,kBAAQL,OADU;AAElBX,qBAAWC,UAFO;AAGlBgB,2BAAiBL,gBAHC;AAIlBM,oBAAUL,SAJQ;AAKlBC;AALkB,SAApB;AAOAL,iBAASU,IAAT,CAAcJ,WAAd;AACD,OAjBD;AAkBA,aAAON,QAAP;AACD,KArBD;;AAuBA,UAAMW,uBAAwBC,iBAAD,IAAuB;AAClD,YAAMC,YAAY,EAAlB;AACAD,wBAAkBX,OAAlB,CAA0B,CACxB;AACEa,cADF;AAEEtB,kBAFF;AAGEW,wBAHF;AAIEY,kBAJF;AAKEC,WALF;AAMEC;AANF,OADwB,KASrB;AACH,cAAMC,aAAa;AACjBC,iBAAOL,MADU;AAEjBvB,qBAAWC,UAFM;AAGjBgB,2BAAiBL,gBAHA;AAIjBiB,qBAAWL,UAJM;AAKjBC,aALiB;AAMjBC;AANiB,SAAnB;AAQAJ,kBAAUH,IAAV,CAAeQ,UAAf;AACD,OAnBD;AAoBA,aAAOL,SAAP;AACD,KAvBD;;AAyBA,UAAMrC,eAAesB,mBAAmBjB,eAAewC,cAAlC,CAArB;AACA,UAAM5C,iBAAiBkC,qBAAqB9B,eAAeyC,eAApC,CAAvB;;AAEAxD,YAAQ;AACNiB,kBADM;AAENO,iBAFM;AAGNd,kBAHM;AAINC;AAJM,KAAR;AAMD,GAnGH,EAoGG8C,KApGH,CAoGSC,WAAWzD,MAAMyD,OAAN,CApGpB;AAqGD,CAtGM;;kBAwGQ,I","file":"campaigns.js","sourcesContent":["import * as db from './db';\n\nexport const getCampaignContent = (campaignId, success, error) => {\n  db.campaigns.find({\n    where: { campaignId },\n    include: [\n      {\n        model: db.campaignContent,\n        where: {\n          campaign_id: campaignId,\n          content_status: 'current',\n        },\n        include: [\n          {\n            model: db.campaignText,\n          },\n          {\n            model: db.campaignImages,\n          },\n        ],\n      },\n    ],\n  })\n    .then((results) => {\n      const rawCampaignData = results;\n      const rawContentData = results.campaign_contents[0];\n\n      const campaignInfo = {\n        campaignId: rawCampaignData.campaignId,\n        name: rawCampaignData.name,\n        length: rawCampaignData.length,\n        fundingNeeded: rawCampaignData.fundingNeeded,\n        donationsMade: rawCampaignData.donationsMade,\n        startDate: rawCampaignData.startDate,\n        endDate: rawCampaignData.endDate,\n      };\n\n      const contentInfo = {\n        contentId: rawContentData.content_id,\n        campaignId: rawContentData.campaign_id,\n        contentStatus: rawContentData.content_status,\n        createdDate: rawContentData.created_date,\n        updatedDate: rawContentData.updatedAt,\n      };\n\n      const gatherCampaignText = (rawTextData) => {\n        const textData = [];\n        rawTextData.forEach((\n          {\n            text_id,\n            content_id,\n            content_position,\n            text_type,\n            text,\n          },\n        ) => {\n          const textElement = {\n            textId: text_id,\n            contentId: content_id,\n            contentPosition: content_position,\n            textType: text_type,\n            text,\n          };\n          textData.push(textElement);\n        });\n        return textData;\n      };\n\n      const gatherCampaignImages = (rawCampaignImages) => {\n        const imageData = [];\n        rawCampaignImages.forEach((\n          {\n            img_id,\n            content_id,\n            content_position,\n            image_type,\n            src,\n            alt,\n          },\n        ) => {\n          const imgElement = {\n            imgId: img_id,\n            contentId: content_id,\n            contentPosition: content_position,\n            imageType: image_type,\n            src,\n            alt,\n          };\n          imageData.push(imgElement);\n        });\n        return imageData;\n      };\n\n      const campaignText = gatherCampaignText(rawContentData.campaign_texts);\n      const campaignImages = gatherCampaignImages(rawContentData.campaign_images);\n\n      success({\n        campaignInfo,\n        contentInfo,\n        campaignText,\n        campaignImages,\n      });\n    })\n    .catch(findErr => error(findErr));\n};\n\nexport default null;\n"]}